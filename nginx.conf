# Management UI server block
server {
    listen 8080;  # NGINX listens externally on port 8080
    location / {
        proxy_pass http://127.0.0.1:15672;  # Forward to RabbitMQ Management UI
    }
}

# Proxy AMQP traffic
stream {
    upstream rabbitmq {
        server 127.0.0.1:5672;  # Forward to RabbitMQ
    }

    server {
        listen 5672;

        # Optional: Validate protocol (basic validation, not full AMQP parsing)
        proxy_pass rabbitmq;

        # Optionally log invalid attempts
        error_log /var/log/nginx/amqp_error.log debug;
    }
}
